<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<title>NEXT</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<link href="../plugins/semantic/semantic.min.css" rel="stylesheet" type="text/css" />
<link href="../plugins/ionicons/css/ionicons.min.css" rel="stylesheet" type="text/css"/>
<script>if (typeof module === 'object') {window.module = module; module = undefined;}</script>
<script src="../plugins/vuejs/vue.min.js"></script>
<script src="../plugins/jquery/jquery.min.js"></script>
<script src="../plugins/semantic/semantic.min.js"></script>
<script src="../plugins/axios/axios.min.js"></script>
<script src="../plugins/moment/moment-with-locales.js"></script>
<script src="../plugins/feathericons/feather.min.js"></script>
<script src="../plugins/sweetalert2/sweetalert2.all.min.js"></script>
<style>
.top
{
	margin-bottom:50px;
}

.svg-icon {
    height: 5em;
    margin-top: -4px;
    pointer-events: none;
    vertical-align: middle;
    width: 5em;
}

.logo-icon {
    height: 5em;
    margin-top: -4px;
    pointer-events: none;
    vertical-align: middle;
    width: 5em;
	color:#6435c9;
	display:inline-block;
	float: left;
}

.logo-text {
	display:inline-block;
	font-size:18pt;
    vertical-align: middle;
	margin-top:20px;
}

.item-icon {
    height: 3em;
    margin-top: 15px;
	margin-left: 15px;
    pointer-events: none;
    vertical-align: middle;
    width: 3em;
	color:#ffffff;
}

.circle
{
	border-radius: 50%;
    width: 5em;
    height: 5em;
	background:#6435c9;
	display:inline-block;
}

.svg-icon-small {
    height: 2em;
    margin-top: -4px;
    pointer-events: none;
    vertical-align: middle;
    width: 2em;
}

.svg-icon-tiny {
    height: 1em;
    pointer-events: none;
    vertical-align: middle;
    width: 1em;
}

.item
{
	margin-top:15px;
	vertical-align:center;
}
.item-desc
{
	margin-left:15px;
	font-size:12pt;
}
</style>
</head>
<body>
<div id="app">
	<br/>
	<div class="ui container" v-show="walletExist && walletUnlocked">
		<div class="ui grid">
			<div class="twelve wide column">
				<h4>
					<span class="ui label "><i data-feather="feather" class="text-violet"></i></span>
					&nbsp;NEXT Light Wallet
				</h4>
			</div>
			<div class="four wide column">
				<div class="right floated" style="text-align:right">
					<button type="button" class="ui button gray tiny" title="Lock Wallet" v-on:click="lockWallet()"><i data-feather="lock" class="svg-icon-tiny"></i></button>&nbsp;Build 0.0.1
				</div>
			</div>
		</div>
  
		<div class="ui top attached tabular menu">
			<a class="item active" data-tab="first">Balance</a>
			<a class="item" data-tab="second">Receive</a>
			<a class="item" data-tab="third">Send</a>
			<a class="item" data-tab="four">Community Fund</a>
			<a class="item" data-tab="five">Sign Message</a>
			<a class="item" data-tab="six">Verify Message</a>
			<a class="item" data-tab="seven">Tools</a>
		</div>
		
		<div class="ui bottom attached tab segment active" data-tab="first">
			<h1>{{balance}} {{unit}}</h1>
			<h5>Height {{height}}</h5>
		</div>
		
		<div class="ui bottom attached tab segment" data-tab="second">
			<h3>Receive</h3>
			<p v-if="addressList">{{addressList}}</p>
		</div>
		<div class="ui bottom attached tab segment" data-tab="third">
			<h3>Send</h3>
			<form class="ui form">
				  <div class="field">
					<label>Address</label>
					<input type="text" name="send_address" placeholder="Address" v-model="send_address">
				  </div>
				  <div class="field">
					<label>Amount</label>
					<input type="text" name="send_amount" placeholder="Amount" v-model="send_amount">
				  </div>
				  <a class="ui button" v-on:click="send()">Send</a>
				  <p>{{result_send}}</p>
			</form>
			<div class="ui accordion">
				<div class="title">
					<i class="dropdown icon"></i>
					UTXOs
				</div>
				<div class="content">
					<pre>{{utxo}}</pre>
				</div>
			</div>
		</div>
		
		<div class="ui bottom attached tab segment" data-tab="four">
			<h3>Community Fund</h3>
			<form class="ui form">
			  <div class="field">
				<label>Required Amount (NAV)</label>
				<input type="text" name="strdzeel_n" placeholder="Amount" v-model="strdzeel_n">
			  </div>
			  <div class="field">
				<label>Address</label>
				<input type="text" name="strdzeel_a" placeholder="Address" v-model="strdzeel_a">
			  </div>
  			  <div class="field">
				<label>Deadline</label>
				<input type="text" name="strdzeel_d" placeholder="Deadline" v-model="strdzeel_d">
			  </div>
   			  <div class="field">
				<label>Proposal Description</label>
				<input type="text" name="strdzeel_s" placeholder="Description" v-model="strdzeel_s">
			  </div>
			  <a class="ui button" v-on:click="createProposal()">Create Proposal</a>
			  <p>{{result_create_proposal}}</p>
			</form>
		</div>
		
		<div class="ui bottom attached tab segment" data-tab="five">
			<h3>Sign Message</h3>
			<form class="ui form">
				  <div class="field">
					<label>Message</label>
					<input type="text" name="message" placeholder="Message" v-model="message">
				  </div>
				  <div class="field">
					<label>Private Key</label>
					<input type="text" name="privateKey" placeholder="Private Key" v-model="privateKey">
				  </div>
				  <a class="ui button" v-on:click="sign()">Sign</a>
				  <p>{{result_signature}}</p>
			</form>
		</div>
		
		<div class="ui bottom attached tab segment" data-tab="six">
			<h3>Verify Message</h3>
			<form class="ui form">
				  <div class="field">
					<label>Message</label>
					<input type="text" name="verify_message" placeholder="Message" v-model="verify_message">
				  </div>
				  <div class="field">
					<label>Address</label>
					<input type="text" name="verify_address" placeholder="Address" v-model="verify_address">
				  </div>
				  <div class="field">
					<label>Signature</label>
					<input type="text" name="verify_signature" placeholder="Signature" v-model="verify_signature">
				  </div>
				  <a class="ui button" v-on:click="verify()">Verify</a>
				  <p>{{result_verify}}</p>
			</form>
		</div>

		<div class="ui bottom attached tab segment" data-tab="seven">
			<button class="ui button gray right floated" v-on:click="getnewaddress()">Show Private Key & Mnemonics</button>
			<h3>Private Key</h3>
			<div v-if="address" class="ui message">
				<h5>Public Address</h5><p>{{address}}</p>
				<h5>Private Key</h5><p>{{privateKey}}</p>
			</div>
			<h3>Mnemonics</h3>
			<div v-if="address" class="ui message">
				<p>{{mnemonics}}</p>
			</div>
		</div>
	</div>
	<div class="ui container" v-show="!walletExist && step==0">
			<div class="top">
				<div>
					<i data-feather="feather" class="logo-icon"></i>
				</div>
				<div class="logo-text">&nbsp;Welcome to the NEXT Lite Wallet</div>
			</div>
			<div class="ui list" style="margin-top:50px;">
				<div class="item">
					<div class="content">
						<div class="circle">
							<i data-feather="layers" class="item-icon"></i>
						</div>
						<span class="item-desc">
							The NEXT Lite Wallet allows you to quickly interact with the NavCoin blockchain.
						</span>
					</div>
				</div>
				<div class="item">
					<div class="circle">
						<i data-feather="shield" class="item-icon"></i>
					</div>
					<span class="item-desc">
						All your private keys are stored locally and you have all the control.
					</span>
				</div>
				<div class="item">
					<div class="circle">
						<i data-feather="watch" class="item-icon"></i>
					</div>
					<span class="item-desc">
						There is no need to synchronize with the network. Open the wallet and you're ready to go.
					</span>
				</div>
			</div>
		<div style="margin-top:50px;">
			<button class="ui button blue large" v-on:click="nextStep()"><i data-feather="chevron-right" class="svg-icon-small"></i>Get Started</button>
		</div>
	</div>
	<div class="ui container" v-show="!walletExist && step==1">
			<div class="top">
				<div>
					<i data-feather="feather" class="logo-icon"></i>
				</div>
				<div class="logo-text">&nbsp;Welcome to the NEXT Lite Wallet</div>
			</div>
			<form class="ui form">
				<h4 class="ui dividing header">Create Wallet</h4>
				<label>Please provide a password for your wallet</label>				
				<br/><br/>
			  <div class="field">
			    <label>Password</label>
			    <input type="password" name="password" v-model="password" placeholder="" autofocus>
			  </div>
			  <div class="field">
			    <label>Password (Again)</label>
			    <input type="password" name="password_again" v-model="password_again" placeholder="">
			  </div>
			  <button type="button" class="ui button gray large" v-on:click="createWallet()"><i data-feather="database" class="svg-icon-small"></i>&nbsp;Create My Wallet</button>
			</form>
	</div>
	<div class="ui container" v-show="walletExist && !walletUnlocked">
		<div class="top">
			<div>
				<i data-feather="feather" class="logo-icon"></i>
			</div>
			<div class="logo-text">&nbsp;Welcome to the NEXT Lite Wallet</div>
		</div>
		<div class="ui form">
			<h4 class="ui dividing header">Unlock Wallet</h4>
			<label>Please enter your wallet password</label>				
			<br/><br/>
		  <div class="field">
		    <label>Password</label>
		    <input type="password" name="password" v-model="password" placeholder="" autofocus>
		  </div>
		  <button type="button" class="ui button gray large" v-on:click="unlockWallet()"><i data-feather="unlock" class="svg-icon-small"></i>&nbsp;Unlock Wallet</button>
		</div>
	</div>
</div>
<script>
$(document).ready(function(){
    $('.menu .item').tab({history:false});
	$('.accordion').accordion();
});
var app = new Vue({
  el: '#app',
  data: {
  	config:{headers: {'Content-Type': 'application/x-www-form-urlencoded'},responseType: 'text'},
  	step:0,
  	password:'',
  	password_again:'',
  	walletUnlocked:false,
    walletExist:false,
	balance: '0.00',
	height:'',
	unit: 'NAV',
	address: '',
	addressList:'',
	mnemonics:'',
	message:'',
	privateKey:'',
	signature:'',
	verify_message:'',
	verify_address:'',
	verify_signature:'',
	result_signature:'',
	result_verify:'',
	send_address:'',
	send_amount:'',
	result_send:'',
	strdzeel_v:2,
	strdzeel_n:'',
	strdzeel_a:'',
	strdzeel_d:'',
	strdzeel_s:'',
	result_create_proposal:'',
	utxo:[],
  },
  created: function()
  {
	this.isWalletExist();
	this.refresh();
	this.strdzeel_n=1;
	this.strdzeel_d=5184180;
	this.strdzeel_s="NEXT Light Wallet Test Proposal";
  },
  methods:{
    refresh: function ()
	{
		if (this.walletExist && this.walletUnlocked)
		{
			this.getBalance();
			this.getHeight();
			this.listAddr();
			this.getUTXO();
		}
	},
	isWalletExist: function ()
	{
		let vm=this;
		axios.post('http://127.0.0.1:3001/iswalletexist', {})
		.then(function (response)
		{
			vm.walletExist=response.data.exist;
			vm.refresh();
		})
		.catch(function (error)
		{
			console.log(error);
		})
		.then(function ()
		{
		});  
    },
    unlockWallet: function ()
	{
		if (!this.password)
		{
			swal({title:"Unlock Wallet",type:"warning",html:"Please specify a password for unlock."});
		}
		else
		{
			let vm=this;
			axios.post('http://127.0.0.1:3001/unlockwallet', {password: vm.password},this.config)
			.then(function (response)
			{
				if (!response.data.isUnlocked)
				{
					swal({title:"Unlock Wallet",type:"error",html:"Your password is not verified."});
				}
				else
				{
					const Toast = Swal.mixin({
					  toast: true,
					  showConfirmButton: false,
					  timer: 3000
					});

					Toast.fire({
					  type: 'success',
					  title: 'Your wallet is unlocked'
					})
				}
				vm.walletUnlocked=response.data.isUnlocked;
				vm.refresh();
			})
			.catch(function (error)
			{
				console.log(error);
			})
			.then(function ()
			{
			});
		}
    },
	lockWallet:function()
	{
		this.password=null;
		this.walletUnlocked=false;
	},
    nextStep: function ()
	{	
		this.step++;
    },
    createWallet: function ()
	{
		if (!this.password)
		{
			swal({title:"Create Wallet",type:"warning",html:"Please specify a password"});
		}
		else if (this.password.length<6)
		{
			swal({title:"Create Wallet",type:"warning",html:"Password minimum length is 6"});
		}
		else if (this.password!=this.password_again)
		{
			swal({title:"Create Wallet",type:"warning",html:"Your passwords did not match"});
		}
		else
		{
			let vm=this;
			axios.post('http://127.0.0.1:3001/initwallet', {password: vm.password},this.config)
			.then(function (response)
			{
				//console.log(response.data);
				vm.walletExist=true;
				vm.walletUnlocked=true;
				vm.refresh();
			})
			.catch(function (error)
			{
				console.log(error);
			})
			.then(function ()
			{
			});  
		}

    },
    getBalance: function ()
	{	
		let vm=this;
		axios.post('http://127.0.0.1:3001/balance', {})
		.then(function (response)
		{
			//console.log(response.data);
			vm.balance=response.data;
		})
		.catch(function (error)
		{
			console.log(error);
		})
		.then(function ()
		{
		});  
    },
	getHeight: function ()
	{
		let vm=this;
		axios.post('http://127.0.0.1:3001/height', {})
		.then(function (response)
		{
			console.log(response.data);
			vm.height=response.data;
		})
		.catch(function (error)
		{
			console.log(error);
		})
		.then(function ()
		{
		});  
    },
	getUTXO: function ()
	{	
		let vm=this;
		axios.post('http://127.0.0.1:3001/utxo', {})
		.then(function (response)
		{
			//console.log(response.data);
			vm.utxo=response.data;
		})
		.catch(function (error)
		{
			console.log(error);
		})
		.then(function ()
		{
		});  
    },
	listAddr: function ()
	{
		let vm=this;
		axios.post('http://127.0.0.1:3001/listaddr', {})
		.then(function (response)
		{
			vm.addressList=response.data;
			vm.strdzeel_a=vm.addressList;
		})
		.catch(function (error)
		{
			console.log(error);
		})
		.then(function ()
		{
		});  
    },
    getnewaddress: function ()
	{
		let vm=this;
		axios.post('http://127.0.0.1:3001/generate', {})
		.then(function (response)
		{
			console.log(response.data);
			vm.address=response.data.address;
			vm.privateKey=response.data.privateKey;
			vm.mnemonics=response.data.mnemonics;
		})
		.catch(function (error)
		{
			console.log(error);
		})
		.then(function ()
		{
		});  
    },
	sign: function ()
	{
		let vm=this;
		axios.post('http://127.0.0.1:3001/sign', {message: this.message, privateKey:this.privateKey},this.config)
		.then(function (response)
		{
			//console.log(response.data);
			if (!response.data.error)
			{
				vm.result_signature=response.data.signature;
			}
			else
			{
				vm.result_signature=response.data.message;
			}
		})
		.catch(function (error)
		{
			console.log(error);
		})
		.then(function ()
		{
		});  
    },
	verify: function ()
	{
		let vm=this;
		axios.post('http://127.0.0.1:3001/verify', {message: this.verify_message, address:this.verify_address, signature:this.verify_signature},this.config)
		.then(function (response)
		{
			//console.log(response.data);
			if (!response.data.error)
			{
				vm.result_verify=response.data.result;
			}
			else
			{
				vm.result_verify=response.data.message;
			}
		})
		.catch(function (error)
		{
			console.log(error);
		})
		.then(function ()
		{
		});  
    },
	send: function ()
	{
		let vm=this;
		axios.post('http://127.0.0.1:3001/send', {to: this.send_address, amount:this.send_amount},this.config)
		.then(function (response)
		{
			console.log(response.data);
			if (!response.data.error)
			{
				vm.result_send=response.data.hex;
			}
			else
			{
				vm.result_send=response.data.message;
			}
		})
		.catch(function (error)
		{
			console.log(error);
		})
		.then(function ()
		{
		}); 
	},
	createProposal: function ()
	{
		let vm=this;
		axios.post('http://127.0.0.1:3001/createproposal', {v:this.strdzeel_v,n: this.strdzeel_n,a:this.strdzeel_a,d:this.strdzeel_d,s:this.strdzeel_s},this.config)
		.then(function (response)
		{
			console.log(response.data);
			if (!response.data.error)
			{
				vm.result_create_proposal=response.data.hex;
			}
			else
			{
				vm.result_create_proposal=response.data.message;
			}
		})
		.catch(function (error)
		{
			console.log(error);
		})
		.then(function ()
		{
		}); 
	}
  }
})
</script>
<script>
	feather.replace();
</script>
</html>